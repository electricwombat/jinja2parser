$(function(){var e,t=CodeMirror.fromTextArea($("#templateVars").get(0),{mode:"yaml",lineNumbers:!0,theme:"ambiance",extraKeys:{F11:function(e){e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){e.getOption("fullScreen")&&e.setOption("fullScreen",!1)}}}),n=CodeMirror.fromTextArea($("#template").get(0),{mode:"jinja2",lineNumbers:!0,theme:"ambiance",extraKeys:{F11:function(e){e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){e.getOption("fullScreen")&&e.setOption("fullScreen",!1)}}});var o=function(e){var t=null;if(document.cookie&&""!==document.cookie)for(var n=document.cookie.split(";"),o=0;o<n.length;o++){var c=n[o].trim();if(c.substring(0,e.length+1)===e+"="){t=decodeURIComponent(c.substring(e.length+1));break}}return t}("csrftoken");function c(e){var t=$("<textarea>");$("body").append(t),t.val(e).select(),document.execCommand("copy"),t.remove()}function l(e){document.body.removeChild(e.target)}function r(e){var t=new Blob([e],{type:"text/plain"}),n=document.createElement("a");n.download="myfile.txt",n.innerHTML="LINKTITLE",window.URL=window.URL||window.webkitURL,n.href=window.URL.createObjectURL(t),n.onclick=l,n.style.display="none",document.body.appendChild(n),n.click()}$.ajaxSetup({beforeSend:function(e,t){var n;n=t.type,/^(GET|HEAD|OPTIONS|TRACE)$/.test(n)||this.crossDomain||e.setRequestHeader("X-CSRFToken",o)}}),$('[data-toggle="tooltip"]').tooltip(),$("#projectSelect").on("change",function(e){var t=$("option:selected",this).attr("data-id");e.preventDefault(),$("#versionSelect > option").remove(),$("#templateSelect > option").remove(),$("#varFileSelect > option").remove(),$.ajax({url:"/projects/"+t+"/versions",type:"GET",success:function(e){$("#versionSelect").html(e).trigger("change")},error:function(e,t,n){console.log(e.status+": "+e.responseText)}})}),$("#versionSelect").on("change",function(e){var t=$("option:selected",this).attr("data-id");e.preventDefault(),$("#templateSelect > option").remove(),$("#varFileSelect > option").remove(),$.ajax({url:"/versions/"+t+"/templates",type:"GET",success:function(e){console.log("success!!"),$("#templateSelect").html(e).trigger("change")},error:function(e,t,n){console.log(e.status+": "+e.responseText)}}),$.ajax({url:"/versions/"+t+"/details",type:"GET",success:function(e){console.log("success!!"),$("#versionDetails").html(e)},error:function(e,t,n){console.log(e.status+": "+e.responseText)}})}),$("#templateSelect").on("change",function(e){var t=$("option:selected",this).attr("data-id"),o=$("option:selected",this).attr("data-file-url");e.preventDefault(),$("#varFileSelect > option").remove(),$.ajax({url:o,type:"GET",success:function(e){n.setValue(e)},error:function(e,t,n){console.log(e.status+": "+e.responseText)}}),$.ajax({url:"/templates/"+t+"/varfiles",type:"GET",success:function(e){$("#varFileSelect").html(e).trigger("change")},error:function(e,t,n){console.log(e.status+": "+e.responseText)}})}),$("#varFileSelect").on("change",function(e){var n=$("option:selected",this).attr("data-file-url");e.preventDefault(),$.ajax({url:n,type:"GET",success:function(e){t.setValue(e)},error:function(e,t,n){console.log(e.status+": "+e.responseText)}})}),$("#templateVarsCopy").on("click",function(e){c(t.getValue())}),$("#templateVarsClear").on("click",function(e){t.setValue("")}),$("#templateVarsFullScreen").on("click",function(e){t.setOption("fullScreen",!t.getOption("fullScreen"))}),$("#templateVarsUndo").on("click",function(e){t.execCommand("undo")}),$("#templateVarsSave").on("click",function(e){r(t.getValue())}),$("#templateCopy").on("click",function(e){c(n.getValue())}),$("#templateClear").on("click",function(e){n.setValue("")}),$("#templateFullScreen").on("click",function(e){n.setOption("fullScreen",!n.getOption("fullScreen"))}),$("#templateUndo").on("click",function(e){n.execCommand("undo")}),$("#templateSave").on("click",function(e){r(n.getValue())}),$("#convert").on("click",function(o){o.preventDefault(),console.log("convert triggered"),e=n.getValue(),$.ajax({url:"/convert",type:"POST",data:{template:n.getValue(),templateVars:t.getValue(),trim_blocks:$("#trimBlocks").prop("checked"),lstrip_blocks:$("#lstripBlocks").prop("checked"),strict_undefined:$("#strictUndefined").prop("checked")},success:function(e){console.log(e),n.setValue(e)},error:function(e,t,n){alert(e.responseText)}})}),$("#undo").on("click",function(t){t.preventDefault(),n.setValue(e)})});